{
    "name": "Optimization Detective",
    "slug": "optimization-detective",
    "version": "0.6.0",
    "author": "<a href=\"https://make.wordpress.org/performance/\">WordPress Performance Team</a>",
    "author_profile": "https://profiles.wordpress.org/performanceteam/",
    "contributors": {
        "wordpressdotorg": {
            "profile": "https://profiles.wordpress.org/wordpressdotorg/",
            "avatar": "https://secure.gravatar.com/avatar/61ee2579b8905e62b4b4045bdc92c11a?s=96&d=monsterid&r=g",
            "display_name": "WordPress.org"
        }
    },
    "requires": "6.5",
    "tested": "6.6.2",
    "requires_php": "7.2",
    "requires_plugins": [],
    "compatibility": [],
    "rating": 0,
    "ratings": {
        "5": 0,
        "4": 0,
        "3": 0,
        "2": 0,
        "1": 0
    },
    "num_ratings": 0,
    "support_url": "https://wordpress.org/support/plugin/optimization-detective/",
    "support_threads": 1,
    "support_threads_resolved": 0,
    "active_installs": 10000,
    "last_updated": "2024-09-23 17:49:00",
    "added": "2024-03-22",
    "homepage": "https://github.com/WordPress/performance/tree/trunk/plugins/optimization-detective",
    "sections": {
        "description": "<p>This plugin captures real user metrics about what elements are displayed on the page across a variety of device form factors (e.g. desktop, tablet, and phone) in order to apply loading optimizations which are not possible with WordPress‚Äôs current server-side heuristics. This plugin is a dependency which does not provide end-user functionality on its own. For that, please install the dependent plugin <a href=\"https://wordpress.org/plugins/image-prioritizer/\" rel=\"ugc\">Image Prioritizer</a> (among <a href=\"https://github.com/WordPress/performance/labels/%5BPlugin%5D%20Optimization%20Detective\" rel=\"nofollow ugc\">others</a> to come from the WordPress Core Performance team).</p>\n<h4>Background</h4>\n<p>WordPress uses <a href=\"https://make.wordpress.org/core/2023/07/13/image-performance-enhancements-in-wordpress-6-3/\" rel=\"nofollow ugc\">server-side heuristics</a> to make educated guesses about which images are likely to be in the initial viewport. Likewise, it uses server-side heuristics to identify a hero image which is likely to be the Largest Contentful Paint (LCP) element. To optimize page loading, it avoids lazy-loading any of these images while also adding <code>fetchpriority=high</code> to the hero image. When these heuristics are applied successfully, the LCP metric for page loading can be improved 5-10%. Unfortunately, however, there are limitations to the heuristics that make the correct identification of which image is the LCP element only about 50% effective. See <a href=\"https://make.wordpress.org/core/2023/09/19/analyzing-the-core-web-vitals-performance-impact-of-wordpress-6-3-in-the-field/\" rel=\"nofollow ugc\">Analyzing the Core Web Vitals performance impact of WordPress 6.3 in the field</a>. For example, it is <a href=\"https://github.com/GoogleChromeLabs/wpp-research/pull/73\" rel=\"nofollow ugc\">common</a> for the LCP element to vary between different viewport widths, such as desktop versus mobile. Since WordPress&#8217;s heuristics are completely server-side it has no knowledge of how the page is actually laid out, and it cannot prioritize loading of images according to the client&#8217;s viewport width.</p>\n<p>In order to increase the accuracy of identifying the LCP element, including across various client viewport widths, this plugin gathers metrics from real users (RUM) to detect the actual LCP element and then use this information to optimize the page for future visitors so that the loading of the LCP element is properly prioritized. This is the purpose of Optimization Detective. The approach is heavily inspired by Philip Walton‚Äôs <a href=\"https://philipwalton.com/articles/dynamic-lcp-priority/\" rel=\"nofollow ugc\">Dynamic LCP Priority: Learning from Past Visits</a>. See also the initial exploration document that laid out this project: <a href=\"https://docs.google.com/document/u/1/d/16qAJ7I_ljhEdx2Cn2VlK7IkiixobY9zNn8FXxN9T9Ls/view\" rel=\"nofollow ugc\">Image Loading Optimization via Client-side Detection</a>.</p>\n<h4>Technical Foundation</h4>\n<p>At the core of Optimization Detective is the ‚ÄúURL Metric‚Äù, information about a page according to how it was loaded by a client with a specific viewport width. This includes which elements were visible in the initial viewport and which one was the LCP element. Each URL on a site can have an associated set of these URL Metrics (stored in a custom post type) which are gathered from real users. It gathers a sample of URL Metrics according to common responsive breakpoints (e.g. mobile, tablet, and desktop). When no more URL Metrics are needed for a URL due to the sample size being obtained for the breakpoints, it discontinues serving the JavaScript to gather the metrics (leveraging the <a href=\"https://github.com/GoogleChrome/web-vitals\" rel=\"nofollow ugc\">web-vitals.js</a> library). With the URL Metrics in hand, the output-buffered page is sent through the HTML Tag Processor and&#8211;when the <a href=\"https://wordpress.org/plugins/image-prioritizer/\" rel=\"ugc\">Image Prioritizer</a> dependent plugin is installed&#8211;the images which were the LCP element for various breakpoints will get prioritized with high-priority preload links (along with <code>fetchpriority=high</code> on the actual <code>img</code> tag when it is the common LCP element across all breakpoints). LCP elements with background images added via inline <code>background-image</code> styles are also prioritized with preload links.</p>\n<p>URL Metrics have a ‚Äúfreshness TTL‚Äù after which they will be stale and the JavaScript will be served again to start gathering metrics again to ensure that the right elements continue to get their loading prioritized. When a URL Metrics custom post type hasn&#8217;t been touched in a while, it is automatically garbage-collected.</p>\n<p>üëâ <strong>Note:</strong> This plugin optimizes pages for actual visitors, and it depends on visitors to optimize pages (since URL metrics need to be collected). As such, you won&#8217;t see optimizations applied immediately after activating the plugin (and dependent plugin(s)). And since administrator users are not normal visitors typically, optimizations are not applied for admins by default (but this can be overridden with the <code>od_can_optimize_response</code> filter below). URL metrics are not collected for administrators because it is likely that additional elements will be present on the page which are not also shown to non-administrators, meaning the URL metrics could not reliably be reused between them.</p>\n<p>There are currently <strong>no settings</strong> and no user interface for this plugin since it is designed to work without any configuration.</p>\n<p>When the <code>WP_DEBUG</code> constant is enabled, additional logging for Optimization Detective is added to the browser console.</p>\n<h4>Hooks</h4>\n<p><strong>Filter:</strong> <code>od_breakpoint_max_widths</code> (default: [480, 600, 782])</p>\n<p>Filters the breakpoint max widths to group URL metrics for various viewports. Each number represents the maximum width (inclusive) for a given breakpoint. So if there is one number, 480, then this means there will be two viewport groupings, one for 0&lt;=480, and another &gt;480. If instead there were three provided breakpoints (320, 480, 576) then this means there will be four groups:</p>\n<ol>\n<li>0-320 (small smartphone)</li>\n<li>321-480 (normal smartphone)</li>\n<li>481-576 (phablets)</li>\n<li>&gt;576 (desktop)</li>\n</ol>\n<p>The default breakpoints are reused from Gutenberg which appear to be used the most in media queries that affect frontend styles.</p>\n<p><strong>Filter:</strong> <code>od_can_optimize_response</code> (default: boolean condition, see below)</p>\n<p>Filters whether the current response can be optimized. By default, detection and optimization are only performed when:</p>\n<ol>\n<li>It‚Äôs not a search template (<code>is_search()</code>).</li>\n<li>It‚Äôs not a post embed template (<code>is_embed()</code>).</li>\n<li>It‚Äôs not the Customizer preview (<code>is_customize_preview()</code>)</li>\n<li>It‚Äôs not the response to a <code>POST</code> request.</li>\n<li>The user is not an administrator (<code>current_user_can( 'customize' )</code>).</li>\n</ol>\n<p>During development, you may want to force this to always be enabled:</p>\n<pre><code>&lt;?php\nadd_filter( 'od_can_optimize_response', '__return_true' );\n</code></pre>\n<p><strong>Filter:</strong> <code>od_url_metrics_breakpoint_sample_size</code> (default: 3)</p>\n<p>Filters the sample size for a breakpoint&#8217;s URL metrics on a given URL. The sample size must be greater than zero. During development, it may be helpful to reduce the sample size to 1:</p>\n<pre><code>&lt;?php\nadd_filter( 'od_url_metrics_breakpoint_sample_size', function (): int {\n    return 1;\n} );\n</code></pre>\n<p><strong>Filter:</strong> <code>od_url_metric_storage_lock_ttl</code> (default: 1 minute)</p>\n<p>Filters how long a given IP is locked from submitting another metric-storage REST API request. Filtering the TTL to zero will disable any metric storage locking. This is useful, for example, to disable locking when a user is logged-in with code like the following:</p>\n<pre><code>&lt;?php\nadd_filter( 'od_metrics_storage_lock_ttl', function ( int $ttl ): int {\n    return is_user_logged_in() ? 0 : $ttl;\n} );\n</code></pre>\n<p><strong>Filter:</strong> <code>od_url_metric_freshness_ttl</code> (default: 1 day)</p>\n<p>Filters the freshness age (TTL) for a given URL metric. The freshness TTL must be at least zero, in which it considers URL metrics to always be stale. In practice, the value should be at least an hour. During development, this can be useful to set to zero:</p>\n<pre><code>&lt;?php\nadd_filter( 'od_url_metric_freshness_ttl', '__return_zero' );\n</code></pre>\n<p><strong>Filter:</strong> <code>od_detection_time_window</code> (default: 5 seconds)</p>\n<p>Filters the time window between serve time and run time in which loading detection is allowed to run. This amount is the allowance between when the page was first generated (and perhaps cached) and when the detect function on the page is allowed to perform its detection logic and submit the request to store the results. This avoids situations in which there are missing URL Metrics in which case a site with page caching which also has a lot of traffic could result in a cache stampede.</p>\n<p><strong>Filter:</strong> <code>od_minimum_viewport_aspect_ratio</code> (default: 0.4)</p>\n<p>Filters the minimum allowed viewport aspect ratio for URL metrics.</p>\n<p>The 0.4 value is intended to accommodate the phone with the greatest known aspect<br />\nratio at 21:9 when rotated 90 degrees to 9:21 (0.429).</p>\n<p><strong>Filter:</strong> <code>od_maximum_viewport_aspect_ratio</code> (default: 2.5)</p>\n<p>Filters the maximum allowed viewport aspect ratio for URL metrics.</p>\n<p>The 2.5 value is intended to accommodate the phone with the greatest known aspect<br />\nratio at 21:9 (2.333).</p>\n<p>During development when you have the DevTools console open, for example, the viewport aspect ratio will be wider than normal. In this case, you may want to increase the maximum aspect ratio:</p>\n<pre><code>&lt;?php\nadd_filter( 'od_maximum_viewport_aspect_ratio', function () {\n    return 5;\n} );\n</code></pre>\n<p><strong>Filter:</strong> <code>od_template_output_buffer</code> (default: the HTML response)</p>\n<p>Filters the template output buffer prior to sending to the client. This filter is added to implement <a href=\"https://core.trac.wordpress.org/ticket/43258\" rel=\"nofollow ugc\">#43258</a> in WordPress core.</p>\n",
        "installation": "<h4>Installation from within WordPress</h4>\n<ol>\n<li>Visit <strong>Plugins &gt; Add New</strong>.</li>\n<li>Search for <strong>Optimization Detective</strong>.</li>\n<li>Install and activate the <strong>Optimization Detective</strong> plugin.</li>\n</ol>\n<h4>Manual installation</h4>\n<ol>\n<li>Upload the entire <code>optimization-detective</code> folder to the <code>/wp-content/plugins/</code> directory.</li>\n<li>Visit <strong>Plugins</strong>.</li>\n<li>Activate the <strong>Optimization Detective</strong> plugin.</li>\n</ol>\n",
        "faq": "\n<dt id='where%20can%20i%20submit%20my%20plugin%20feedback%3F'>\nWhere can I submit my plugin feedback?\n</h4>\n<p>\n<p>Feedback is encouraged and much appreciated, especially since this plugin may contain future WordPress core features. If you have suggestions or requests for new features, you can <a href=\"https://github.com/WordPress/performance/issues/new/choose\" rel=\"nofollow ugc\">submit them as an issue in the WordPress Performance Team&#8217;s GitHub repository</a>. If you need help with troubleshooting or have a question about the plugin, please <a href=\"https://wordpress.org/support/plugin/optimization-detective/#new-topic-0\" rel=\"ugc\">create a new topic on our support forum</a>.</p>\n</p>\n<dt id='where%20can%20i%20report%20security%20bugs%3F'>\nWhere can I report security bugs?\n</h4>\n<p>\n<p>The Performance team and WordPress community take security bugs seriously. We appreciate your efforts to responsibly disclose your findings, and will make every effort to acknowledge your contributions.</p>\n<p>To report a security issue, please visit the <a href=\"https://hackerone.com/wordpress\" rel=\"nofollow ugc\">WordPress HackerOne</a> program.</p>\n</p>\n<dt id='how%20can%20i%20contribute%20to%20the%20plugin%3F'>\nHow can I contribute to the plugin?\n</h4>\n<p>\n<p>Contributions are always welcome! Learn more about how to get involved in the <a href=\"https://make.wordpress.org/performance/handbook/get-involved/\" rel=\"nofollow ugc\">Core Performance Team Handbook</a>.</p>\n<p>The <a href=\"https://github.com/WordPress/performance/tree/trunk/plugins/optimization-detective\" rel=\"nofollow ugc\">plugin source code</a> is located in the <a href=\"https://github.com/WordPress/performance\" rel=\"nofollow ugc\">WordPress/performance</a> repo on GitHub.</p>\n</p>\n\n",
        "changelog": "<h4>0.6.0</h4>\n<p><strong>Enhancements</strong></p>\n<ul>\n<li>Allow URL metric schema to be extended. (<a href=\"https://github.com/WordPress/performance/pull/1492\" rel=\"nofollow ugc\">1492</a>)</li>\n<li>Clarify docs around a tag visitor&#8217;s boolean return value. (<a href=\"https://github.com/WordPress/performance/pull/1479\" rel=\"nofollow ugc\">1479</a>)</li>\n<li>Include UUID with each URL metric. (<a href=\"https://github.com/WordPress/performance/pull/1489\" rel=\"nofollow ugc\">1489</a>)</li>\n<li>Introduce get_cursor_move_count() to use instead of get_seek_count() and get_next_token_count(). (<a href=\"https://github.com/WordPress/performance/pull/1478\" rel=\"nofollow ugc\">1478</a>)</li>\n</ul>\n<p><strong>Bug Fixes</strong></p>\n<ul>\n<li>Add missing global documentation for <code>delete_all_posts()</code>. (<a href=\"https://github.com/WordPress/performance/pull/1522\" rel=\"nofollow ugc\">1522</a>)</li>\n<li>Introduce viewport aspect ratio validation for URL Metrics. (<a href=\"https://github.com/WordPress/performance/pull/1494\" rel=\"nofollow ugc\">1494</a>)</li>\n</ul>\n<h4>0.5.0</h4>\n<p><strong>Enhancements</strong></p>\n<ul>\n<li>Bump web-vitals from 4.2.1 to 4.2.2. (<a href=\"https://github.com/WordPress/performance/pull/1386\" rel=\"nofollow ugc\">1386</a>)</li>\n</ul>\n<p><strong>Bug Fixes</strong></p>\n<ul>\n<li>Disable Optimization Detective by default on the embed template. (<a href=\"https://github.com/WordPress/performance/pull/1472\" rel=\"nofollow ugc\">1472</a>)</li>\n<li>Ensure only HTML documents are processed by Optimization Detective. (<a href=\"https://github.com/WordPress/performance/pull/1442\" rel=\"nofollow ugc\">1442</a>)</li>\n<li>Ensure the entire template is passed to the output buffer callback for Optimization Detective to process. (<a href=\"https://github.com/WordPress/performance/pull/1317\" rel=\"nofollow ugc\">1317</a>)</li>\n<li>Implement full support for intersectionRect/boundingClientRect, fix viewportRect typing, and harden JSON schema. (<a href=\"https://github.com/WordPress/performance/pull/1411\" rel=\"nofollow ugc\">1411</a>)</li>\n</ul>\n<h4>0.4.1</h4>\n<p><strong>Enhancements</strong></p>\n<ul>\n<li>Upgrade web-vitals.js from <a href=\"https://github.com/GoogleChrome/web-vitals/blob/main/CHANGELOG.md#v350-2023-09-28\" rel=\"nofollow ugc\">v3.5.0</a> to <a href=\"https://github.com/GoogleChrome/web-vitals/blob/main/CHANGELOG.md#v422-2024-07-17\" rel=\"nofollow ugc\">v4.2.1</a>.</li>\n</ul>\n<p><strong>Bug Fixes</strong></p>\n<ul>\n<li>Fix logic for seeking during optimization loop to prevent emitting seek() notices. (<a href=\"https://github.com/WordPress/performance/pull/1376\" rel=\"nofollow ugc\">1376</a>)</li>\n</ul>\n<h4>0.4.0</h4>\n<p><strong>Enhancements</strong></p>\n<ul>\n<li>Avoid passing positional parameters in Optimization Detective. (<a href=\"https://github.com/WordPress/performance/pull/1338\" rel=\"nofollow ugc\">1338</a>)</li>\n<li>Send preload links via HTTP Link headers in addition to LINK tags. (<a href=\"https://github.com/WordPress/performance/pull/1323\" rel=\"nofollow ugc\">1323</a>)</li>\n</ul>\n<h4>0.3.1</h4>\n<p><strong>Enhancements</strong></p>\n<ul>\n<li>Log URL metrics group collection to console when debugging is enabled (<code>WP_DEBUG</code> is true). (<a href=\"https://github.com/WordPress/performance/pull/1295\" rel=\"nofollow ugc\">1295</a>)</li>\n</ul>\n<p><strong>Bug Fixes</strong></p>\n<ul>\n<li>Include non-intersecting elements in URL metrics to fix lazy-load optimization. (<a href=\"https://github.com/WordPress/performance/pull/1293\" rel=\"nofollow ugc\">1293</a>)</li>\n</ul>\n<h4>0.3.0</h4>\n<ul>\n<li>The image optimization features have been split out into a new dependent plugin called <a href=\"https://wordpress.org/plugins/image-prioritizer/\" rel=\"ugc\">Image Prioritizer</a>, which also now optimizes image lazy-loading. (<a href=\"https://github.com/WordPress/performance/issues/1088\" rel=\"nofollow ugc\">1088</a>)</li>\n</ul>\n<h4>0.2.0</h4>\n<p><strong>Enhancements</strong></p>\n<ul>\n<li>Add optimization_detective_disabled query var to disable behavior. (<a href=\"https://github.com/WordPress/performance/pull/1193\" rel=\"nofollow ugc\">1193</a>)</li>\n<li>Facilitate embedding Optimization Detective in other plugins/themes. (<a href=\"https://github.com/WordPress/performance/pull/1185\" rel=\"nofollow ugc\">1185</a>)</li>\n<li>Use PHP 7.2 features in Optimization Detective. (<a href=\"https://github.com/WordPress/performance/pull/1162\" rel=\"nofollow ugc\">1162</a>)</li>\n<li>Improve overall code quality with stricter static analysis checks. (<a href=\"https://github.com/WordPress/performance/issues/775\" rel=\"nofollow ugc\">775</a>)</li>\n<li>Bump minimum PHP requirement to 7.2. (<a href=\"https://github.com/WordPress/performance/pull/1130\" rel=\"nofollow ugc\">1130</a>)</li>\n</ul>\n<p><strong>Bug Fixes</strong></p>\n<ul>\n<li>Avoid _doing_it_wrong() for Server-Timing in Optimization Detective when output buffering is not enabled. (<a href=\"https://github.com/WordPress/performance/pull/1194\" rel=\"nofollow ugc\">1194</a>)</li>\n<li>Ensure only HTML responses are optimized. (<a href=\"https://github.com/WordPress/performance/pull/1189\" rel=\"nofollow ugc\">1189</a>)</li>\n<li>Fix XPath indices to be 1-based instead of 0-based. (<a href=\"https://github.com/WordPress/performance/pull/1191\" rel=\"nofollow ugc\">1191</a>)</li>\n</ul>\n<h4>0.1.1</h4>\n<ul>\n<li>Use plugin slug for generator tag. (<a href=\"https://github.com/WordPress/performance/pull/1103\" rel=\"nofollow ugc\">1103</a>)</li>\n<li>Prevent detection script injection from breaking import maps in classic themes. (<a href=\"https://github.com/WordPress/performance/pull/1084\" rel=\"nofollow ugc\">1084</a>)</li>\n</ul>\n<h4>0.1.0</h4>\n<ul>\n<li>Initial release.</li>\n</ul>\n"
    },
    "short_description": "Provides an API for leveraging real user metrics to detect optimizations to apply on the frontend to improve page performance.",
    "description": "<p>This plugin captures real user metrics about what elements are displayed on the page across a variety of device form factors (e.g. desktop, tablet, and phone) in order to apply loading optimizations which are not possible with WordPress‚Äôs current server-side heuristics. This plugin is a dependency which does not provide end-user functionality on its own. For that, please install the dependent plugin <a href=\"https://wordpress.org/plugins/image-prioritizer/\" rel=\"ugc\">Image Prioritizer</a> (among <a href=\"https://github.com/WordPress/performance/labels/%5BPlugin%5D%20Optimization%20Detective\" rel=\"nofollow ugc\">others</a> to come from the WordPress Core Performance team).</p>\n<h4>Background</h4>\n<p>WordPress uses <a href=\"https://make.wordpress.org/core/2023/07/13/image-performance-enhancements-in-wordpress-6-3/\" rel=\"nofollow ugc\">server-side heuristics</a> to make educated guesses about which images are likely to be in the initial viewport. Likewise, it uses server-side heuristics to identify a hero image which is likely to be the Largest Contentful Paint (LCP) element. To optimize page loading, it avoids lazy-loading any of these images while also adding <code>fetchpriority=high</code> to the hero image. When these heuristics are applied successfully, the LCP metric for page loading can be improved 5-10%. Unfortunately, however, there are limitations to the heuristics that make the correct identification of which image is the LCP element only about 50% effective. See <a href=\"https://make.wordpress.org/core/2023/09/19/analyzing-the-core-web-vitals-performance-impact-of-wordpress-6-3-in-the-field/\" rel=\"nofollow ugc\">Analyzing the Core Web Vitals performance impact of WordPress 6.3 in the field</a>. For example, it is <a href=\"https://github.com/GoogleChromeLabs/wpp-research/pull/73\" rel=\"nofollow ugc\">common</a> for the LCP element to vary between different viewport widths, such as desktop versus mobile. Since WordPress&#8217;s heuristics are completely server-side it has no knowledge of how the page is actually laid out, and it cannot prioritize loading of images according to the client&#8217;s viewport width.</p>\n<p>In order to increase the accuracy of identifying the LCP element, including across various client viewport widths, this plugin gathers metrics from real users (RUM) to detect the actual LCP element and then use this information to optimize the page for future visitors so that the loading of the LCP element is properly prioritized. This is the purpose of Optimization Detective. The approach is heavily inspired by Philip Walton‚Äôs <a href=\"https://philipwalton.com/articles/dynamic-lcp-priority/\" rel=\"nofollow ugc\">Dynamic LCP Priority: Learning from Past Visits</a>. See also the initial exploration document that laid out this project: <a href=\"https://docs.google.com/document/u/1/d/16qAJ7I_ljhEdx2Cn2VlK7IkiixobY9zNn8FXxN9T9Ls/view\" rel=\"nofollow ugc\">Image Loading Optimization via Client-side Detection</a>.</p>\n<h4>Technical Foundation</h4>\n<p>At the core of Optimization Detective is the ‚ÄúURL Metric‚Äù, information about a page according to how it was loaded by a client with a specific viewport width. This includes which elements were visible in the initial viewport and which one was the LCP element. Each URL on a site can have an associated set of these URL Metrics (stored in a custom post type) which are gathered from real users. It gathers a sample of URL Metrics according to common responsive breakpoints (e.g. mobile, tablet, and desktop). When no more URL Metrics are needed for a URL due to the sample size being obtained for the breakpoints, it discontinues serving the JavaScript to gather the metrics (leveraging the <a href=\"https://github.com/GoogleChrome/web-vitals\" rel=\"nofollow ugc\">web-vitals.js</a> library). With the URL Metrics in hand, the output-buffered page is sent through the HTML Tag Processor and&#8211;when the <a href=\"https://wordpress.org/plugins/image-prioritizer/\" rel=\"ugc\">Image Prioritizer</a> dependent plugin is installed&#8211;the images which were the LCP element for various breakpoints will get prioritized with high-priority preload links (along with <code>fetchpriority=high</code> on the actual <code>img</code> tag when it is the common LCP element across all breakpoints). LCP elements with background images added via inline <code>background-image</code> styles are also prioritized with preload links.</p>\n<p>URL Metrics have a ‚Äúfreshness TTL‚Äù after which they will be stale and the JavaScript will be served again to start gathering metrics again to ensure that the right elements continue to get their loading prioritized. When a URL Metrics custom post type hasn&#8217;t been touched in a while, it is automatically garbage-collected.</p>\n<p>üëâ <strong>Note:</strong> This plugin optimizes pages for actual visitors, and it depends on visitors to optimize pages (since URL metrics need to be collected). As such, you won&#8217;t see optimizations applied immediately after activating the plugin (and dependent plugin(s)). And since administrator users are not normal visitors typically, optimizations are not applied for admins by default (but this can be overridden with the <code>od_can_optimize_response</code> filter below). URL metrics are not collected for administrators because it is likely that additional elements will be present on the page which are not also shown to non-administrators, meaning the URL metrics could not reliably be reused between them.</p>\n<p>There are currently <strong>no settings</strong> and no user interface for this plugin since it is designed to work without any configuration.</p>\n<p>When the <code>WP_DEBUG</code> constant is enabled, additional logging for Optimization Detective is added to the browser console.</p>\n<h4>Hooks</h4>\n<p><strong>Filter:</strong> <code>od_breakpoint_max_widths</code> (default: [480, 600, 782])</p>\n<p>Filters the breakpoint max widths to group URL metrics for various viewports. Each number represents the maximum width (inclusive) for a given breakpoint. So if there is one number, 480, then this means there will be two viewport groupings, one for 0&lt;=480, and another &gt;480. If instead there were three provided breakpoints (320, 480, 576) then this means there will be four groups:</p>\n<ol>\n<li>0-320 (small smartphone)</li>\n<li>321-480 (normal smartphone)</li>\n<li>481-576 (phablets)</li>\n<li>&gt;576 (desktop)</li>\n</ol>\n<p>The default breakpoints are reused from Gutenberg which appear to be used the most in media queries that affect frontend styles.</p>\n<p><strong>Filter:</strong> <code>od_can_optimize_response</code> (default: boolean condition, see below)</p>\n<p>Filters whether the current response can be optimized. By default, detection and optimization are only performed when:</p>\n<ol>\n<li>It‚Äôs not a search template (<code>is_search()</code>).</li>\n<li>It‚Äôs not a post embed template (<code>is_embed()</code>).</li>\n<li>It‚Äôs not the Customizer preview (<code>is_customize_preview()</code>)</li>\n<li>It‚Äôs not the response to a <code>POST</code> request.</li>\n<li>The user is not an administrator (<code>current_user_can( 'customize' )</code>).</li>\n</ol>\n<p>During development, you may want to force this to always be enabled:</p>\n<pre><code>&lt;?php\nadd_filter( 'od_can_optimize_response', '__return_true' );\n</code></pre>\n<p><strong>Filter:</strong> <code>od_url_metrics_breakpoint_sample_size</code> (default: 3)</p>\n<p>Filters the sample size for a breakpoint&#8217;s URL metrics on a given URL. The sample size must be greater than zero. During development, it may be helpful to reduce the sample size to 1:</p>\n<pre><code>&lt;?php\nadd_filter( 'od_url_metrics_breakpoint_sample_size', function (): int {\n    return 1;\n} );\n</code></pre>\n<p><strong>Filter:</strong> <code>od_url_metric_storage_lock_ttl</code> (default: 1 minute)</p>\n<p>Filters how long a given IP is locked from submitting another metric-storage REST API request. Filtering the TTL to zero will disable any metric storage locking. This is useful, for example, to disable locking when a user is logged-in with code like the following:</p>\n<pre><code>&lt;?php\nadd_filter( 'od_metrics_storage_lock_ttl', function ( int $ttl ): int {\n    return is_user_logged_in() ? 0 : $ttl;\n} );\n</code></pre>\n<p><strong>Filter:</strong> <code>od_url_metric_freshness_ttl</code> (default: 1 day)</p>\n<p>Filters the freshness age (TTL) for a given URL metric. The freshness TTL must be at least zero, in which it considers URL metrics to always be stale. In practice, the value should be at least an hour. During development, this can be useful to set to zero:</p>\n<pre><code>&lt;?php\nadd_filter( 'od_url_metric_freshness_ttl', '__return_zero' );\n</code></pre>\n<p><strong>Filter:</strong> <code>od_detection_time_window</code> (default: 5 seconds)</p>\n<p>Filters the time window between serve time and run time in which loading detection is allowed to run. This amount is the allowance between when the page was first generated (and perhaps cached) and when the detect function on the page is allowed to perform its detection logic and submit the request to store the results. This avoids situations in which there are missing URL Metrics in which case a site with page caching which also has a lot of traffic could result in a cache stampede.</p>\n<p><strong>Filter:</strong> <code>od_minimum_viewport_aspect_ratio</code> (default: 0.4)</p>\n<p>Filters the minimum allowed viewport aspect ratio for URL metrics.</p>\n<p>The 0.4 value is intended to accommodate the phone with the greatest known aspect<br />\nratio at 21:9 when rotated 90 degrees to 9:21 (0.429).</p>\n<p><strong>Filter:</strong> <code>od_maximum_viewport_aspect_ratio</code> (default: 2.5)</p>\n<p>Filters the maximum allowed viewport aspect ratio for URL metrics.</p>\n<p>The 2.5 value is intended to accommodate the phone with the greatest known aspect<br />\nratio at 21:9 (2.333).</p>\n<p>During development when you have the DevTools console open, for example, the viewport aspect ratio will be wider than normal. In this case, you may want to increase the maximum aspect ratio:</p>\n<pre><code>&lt;?php\nadd_filter( 'od_maximum_viewport_aspect_ratio', function () {\n    return 5;\n} );\n</code></pre>\n<p><strong>Filter:</strong> <code>od_template_output_buffer</code> (default: the HTML response)</p>\n<p>Filters the template output buffer prior to sending to the client. This filter is added to implement <a href=\"https://core.trac.wordpress.org/ticket/43258\" rel=\"nofollow ugc\">#43258</a> in WordPress core.</p>\n",
    "download_link": "https://downloads.wordpress.org/plugin/optimization-detective.0.6.0.zip",
    "upgrade_notice": {
        "0.3.0": "<p>Image loading optimizations have been moved to a new dependent plugin called Image Prioritizer. The Optimization Detective plugin now serves as a dependency.</p>"
    },
    "screenshots": [],
    "tags": {
        "optimization": "optimization",
        "performance": "performance",
        "rum": "rum"
    },
    "stable_tag": "0.6.0",
    "versions": {
        "0.1.0": "https://downloads.wordpress.org/plugin/optimization-detective.0.1.0.zip",
        "0.1.1": "https://downloads.wordpress.org/plugin/optimization-detective.0.1.1.zip",
        "0.2.0": "https://downloads.wordpress.org/plugin/optimization-detective.0.2.0.zip",
        "0.3.0": "https://downloads.wordpress.org/plugin/optimization-detective.0.3.0.zip",
        "0.3.1": "https://downloads.wordpress.org/plugin/optimization-detective.0.3.1.zip",
        "0.4.0": "https://downloads.wordpress.org/plugin/optimization-detective.0.4.0.zip",
        "0.4.1": "https://downloads.wordpress.org/plugin/optimization-detective.0.4.1.zip",
        "0.5.0": "https://downloads.wordpress.org/plugin/optimization-detective.0.5.0.zip",
        "0.6.0": "https://downloads.wordpress.org/plugin/optimization-detective.0.6.0.zip",
        "trunk": "https://downloads.wordpress.org/plugin/optimization-detective.zip"
    },
    "business_model": "community",
    "repository_url": "https://github.com/WordPress/performance",
    "commercial_support_url": "",
    "donate_link": "",
    "banners": {
        "low": "https://ps.w.org/optimization-detective/assets/banner-772x250.png?rev=3098164",
        "high": "https://ps.w.org/optimization-detective/assets/banner-1544x500.png?rev=3098164"
    },
    "icons": {
        "1x": "https://ps.w.org/optimization-detective/assets/icon.svg?rev=3098164",
        "svg": "https://ps.w.org/optimization-detective/assets/icon.svg?rev=3098164"
    },
    "blocks": [],
    "block_assets": [],
    "author_block_count": 0,
    "author_block_rating": 0,
    "blueprints": [],
    "preview_link": "",
    "language_packs": [
        {
            "type": "plugin",
            "slug": "optimization-detective",
            "language": "es_ES",
            "version": "0.5.0",
            "updated": "2024-07-27 08:16:36",
            "package": "https://downloads.wordpress.org/translation/plugin/optimization-detective/0.5.0/es_ES.zip"
        },
        {
            "type": "plugin",
            "slug": "optimization-detective",
            "language": "zh_TW",
            "version": "0.5.0",
            "updated": "2024-07-21 10:44:38",
            "package": "https://downloads.wordpress.org/translation/plugin/optimization-detective/0.5.0/zh_TW.zip"
        }
    ]
}